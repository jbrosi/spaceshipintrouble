<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js\engine\helper\virtualJoystick.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/engine.entity.Entity.html">engine.entity.Entity</a></li>
            
                <li><a href="../classes/engine.entity.EntityComponent.html">engine.entity.EntityComponent</a></li>
            
                <li><a href="../classes/engine.entity.EntityManager.html">engine.entity.EntityManager</a></li>
            
                <li><a href="../classes/engine.entity.EntityMessage.html">engine.entity.EntityMessage</a></li>
            
                <li><a href="../classes/engine.entity.EntityPrototype.html">engine.entity.EntityPrototype</a></li>
            
                <li><a href="../classes/engine.entity.EntityScript.html">engine.entity.EntityScript</a></li>
            
                <li><a href="../classes/engine.GameInitializer.html">engine.GameInitializer</a></li>
            
                <li><a href="../classes/engine.helper.Box2DHelper.html">engine.helper.Box2DHelper</a></li>
            
                <li><a href="../classes/engine.helper.KeyboardHelper.html">engine.helper.KeyboardHelper</a></li>
            
                <li><a href="../classes/engine.helper.PerformanceTimer.html">engine.helper.PerformanceTimer</a></li>
            
                <li><a href="../classes/engine.helper.StatsHelper.html">engine.helper.StatsHelper</a></li>
            
                <li><a href="../classes/engine.helper.TextHelper.html">engine.helper.TextHelper</a></li>
            
                <li><a href="../classes/engine.helper.VirtualJoystick.html">engine.helper.VirtualJoystick</a></li>
            
                <li><a href="../classes/engine.map.AbstractMapLoader.html">engine.map.AbstractMapLoader</a></li>
            
                <li><a href="../classes/engine.map.MapLayer.html">engine.map.MapLayer</a></li>
            
                <li><a href="../classes/engine.map.MapObject.html">engine.map.MapObject</a></li>
            
                <li><a href="../classes/engine.map.TiledJSONMapLoader.html">engine.map.TiledJSONMapLoader</a></li>
            
                <li><a href="../classes/engine.map.TiledMap.html">engine.map.TiledMap</a></li>
            
                <li><a href="../classes/engine.map.TileSet.html">engine.map.TileSet</a></li>
            
                <li><a href="../classes/engine.screens.AbstractScreen.html">engine.screens.AbstractScreen</a></li>
            
                <li><a href="../classes/engine.screens.LoadLevelScreen.html">engine.screens.LoadLevelScreen</a></li>
            
                <li><a href="../classes/engine.screens.PlayLevelScreen.html">engine.screens.PlayLevelScreen</a></li>
            
                <li><a href="../classes/engine.screens.Screenmanager.html">engine.screens.Screenmanager</a></li>
            
                <li><a href="../classes/engine.util.ResourceLoader.html">engine.util.ResourceLoader</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js\engine\helper\virtualJoystick.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define([&quot;require&quot;, &quot;exports&quot;, &quot;three&quot;, &quot;lodash&quot;, &quot;hammer&quot;], function(require, exports, THREE, _, Hammer) {
    /**
    * Capsulates a virtual joystick. Contains one joystick field (like an analog joystick) and one fire button.
    *
    * @namespace engine.helper
    * @class VirtualJoystick
    */
    var VirtualJoystick = (function () {
        /**
        * Creates a new VirtualJoystick
        *
        * @method __constructor()
        */
        function VirtualJoystick() {
            this._speed = 0;
            this._angle = 0;
            this._isFireButtonPressed = false;
            /**
            * Removes the joystick from the scene
            * @method removeFromScene
            */
            this.removeFromScene = function () {
                this._scene.remove(this._joystickMesh);
                this._scene.remove(this._fireButtonMesh);
            };
            _.bindAll(this);
        }
        /**
        * Creates the meshes for the joystick buttons
        *
        * @method _createMeshes
        * @private
        */
        VirtualJoystick.prototype._createMeshes = function () {
            if (this._joystickMesh) {
                //already created
                return;
            }
            var joystickTexture = THREE.ImageUtils.loadTexture(&#x27;assets/engine/textures/joystick_move.png&#x27;);
            var joystickMat = new THREE.SpriteMaterial({ map: joystickTexture, useScreenCoordinates: true, depthTest: false, depthWrite: false });
            this._joystickMesh = new THREE.Sprite(joystickMat);

            var fireButtonTexture = THREE.ImageUtils.loadTexture(&#x27;assets/engine/textures/joystick_fire.png&#x27;);
            var fireButtonMat = new THREE.SpriteMaterial({ map: fireButtonTexture, useScreenCoordinates: true, depthTest: false, depthWrite: false });
            this._fireButtonMesh = new THREE.Sprite(fireButtonMat);
        };

        /**
        * Registers the Joystick to the current level
        *
        * @method register
        * @param levelScreen the levelScreen to attach the joystick to
        */
        VirtualJoystick.prototype.register = function (levelScreen) {
            if (!this._joystickMesh) {
                this._createMeshes();
            }

            this._scene = levelScreen.getScene();
            this._renderer = levelScreen.getRenderer();

            this._screenHeight = window.innerHeight;
            this._screenWidth = window.innerWidth;

            var size = Math.floor(this._screenHeight / 3);

            this._joystickMesh.scale.set(size, size, 1.0); // imageWidth, imageHeight
            this._joystickMesh.position.set(size / 2, this._screenHeight - (size / 2), 0);

            this._fireButtonMesh.scale.set(size, size, 1.0); // imageWidth, imageHeight
            this._fireButtonMesh.position.set(this._screenWidth - (size / 2), this._screenHeight - (size / 2), 0);

            this._center = { x: size / 2, y: this._screenHeight - (size / 2) };
            this._radius = size / 2;

            this._scene.add(this._joystickMesh);
            this._scene.add(this._fireButtonMesh);

            this._hammer = new Hammer(this._renderer.context.canvas, {
                drag: true,
                transform: false,
                swipe: false,
                drag_max_touches: 10
            });

            this._hammer.on(&#x27;touch drag&#x27;, this._onTouchMove);
            this._hammer.on(&#x27;release&#x27;, this._onTouchEnd);
        };

        /**
        * Internal callback for the touchmove events
        *
        * @method _onTouchMove
        * @param evt the event caught
        * @private
        */
        VirtualJoystick.prototype._onTouchMove = function (evt) {
            //false by default
            this._isFireButtonPressed = false;

            for (var a = 0; a &lt; evt.gesture.touches.length; a++) {
                var touch = evt.gesture.touches[a];

                var x = touch.pageX;
                var y = touch.pageY;

                if (x &lt; this._radius * 2 &amp;&amp; y &gt; this._screenHeight - (this._radius * 2)) {
                    //touched the joystick
                    var diffX = x - this._center.x;
                    var diffY = this._center.y - y;
                    var length = Math.sqrt((diffX * diffX) + (diffY * diffY));

                    this._speed = Math.max(-1, Math.min(1, length / this._radius));

                    this._angle = Math.atan2(diffY, diffX);
                } else if (x &gt; this._screenWidth - (this._radius * 2) &amp;&amp; y &gt; this._screenHeight - (this._radius * 2)) {
                    //firebutton
                    this._isFireButtonPressed = true;
                }
            }
        };

        /**
        * Internal callback for the touchend events
        *
        * @method _onTouchEnd
        * @param evt {TouchEvent}
        * @private
        */
        VirtualJoystick.prototype._onTouchEnd = function (evt) {
            this._speed = 0;
            this._isFireButtonPressed = false;
        };

        /**
        * Returns the current speed. The further your finger gets from the center of the joystick, the higher
        * this value will get. At the center it&#x27;s about 0
        *
        * @method getSpeed
        * @returns {number} the current speed (value between 0 and 1)
        */
        VirtualJoystick.prototype.getSpeed = function () {
            return this._speed;
        };

        /**
        * Returns the angle of the joystick.
        *
        * @method getAngle
        * @returns {number} the angle of the joystick
        */
        VirtualJoystick.prototype.getAngle = function () {
            return this._angle;
        };

        /**
        * @method isFireButtonPressed
        * @returns {boolean} true if the fire button is pressed
        */
        VirtualJoystick.prototype.isFireButtonPressed = function () {
            return this._isFireButtonPressed;
        };
        return VirtualJoystick;
    })();
    ;
    
    return VirtualJoystick;
});
//# sourceMappingURL=virtualJoystick.js.map

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
