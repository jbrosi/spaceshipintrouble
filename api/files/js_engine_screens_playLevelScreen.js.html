<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js\engine\screens\playLevelScreen.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/engine.entity.Entity.html">engine.entity.Entity</a></li>
            
                <li><a href="../classes/engine.entity.EntityComponent.html">engine.entity.EntityComponent</a></li>
            
                <li><a href="../classes/engine.entity.EntityManager.html">engine.entity.EntityManager</a></li>
            
                <li><a href="../classes/engine.entity.EntityMessage.html">engine.entity.EntityMessage</a></li>
            
                <li><a href="../classes/engine.entity.EntityPrototype.html">engine.entity.EntityPrototype</a></li>
            
                <li><a href="../classes/engine.entity.EntityScript.html">engine.entity.EntityScript</a></li>
            
                <li><a href="../classes/engine.GameInitializer.html">engine.GameInitializer</a></li>
            
                <li><a href="../classes/engine.helper.Box2DHelper.html">engine.helper.Box2DHelper</a></li>
            
                <li><a href="../classes/engine.helper.KeyboardHelper.html">engine.helper.KeyboardHelper</a></li>
            
                <li><a href="../classes/engine.helper.PerformanceTimer.html">engine.helper.PerformanceTimer</a></li>
            
                <li><a href="../classes/engine.helper.StatsHelper.html">engine.helper.StatsHelper</a></li>
            
                <li><a href="../classes/engine.helper.TextHelper.html">engine.helper.TextHelper</a></li>
            
                <li><a href="../classes/engine.helper.VirtualJoystick.html">engine.helper.VirtualJoystick</a></li>
            
                <li><a href="../classes/engine.map.AbstractMapLoader.html">engine.map.AbstractMapLoader</a></li>
            
                <li><a href="../classes/engine.map.MapLayer.html">engine.map.MapLayer</a></li>
            
                <li><a href="../classes/engine.map.MapObject.html">engine.map.MapObject</a></li>
            
                <li><a href="../classes/engine.map.TiledJSONMapLoader.html">engine.map.TiledJSONMapLoader</a></li>
            
                <li><a href="../classes/engine.map.TiledMap.html">engine.map.TiledMap</a></li>
            
                <li><a href="../classes/engine.map.TileSet.html">engine.map.TileSet</a></li>
            
                <li><a href="../classes/engine.screens.AbstractScreen.html">engine.screens.AbstractScreen</a></li>
            
                <li><a href="../classes/engine.screens.LoadLevelScreen.html">engine.screens.LoadLevelScreen</a></li>
            
                <li><a href="../classes/engine.screens.PlayLevelScreen.html">engine.screens.PlayLevelScreen</a></li>
            
                <li><a href="../classes/engine.screens.Screenmanager.html">engine.screens.Screenmanager</a></li>
            
                <li><a href="../classes/engine.util.ResourceLoader.html">engine.util.ResourceLoader</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js\engine\screens\playLevelScreen.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
define([&quot;require&quot;, &quot;exports&quot;, &#x27;engine/screens/abstractScreen&#x27;, &#x27;engine/helper/virtualJoystick&#x27;, &#x27;engine/helper/keyboardHelper&#x27;, &#x27;engine/entity/entityManager&#x27;, &#x27;engine/entity/entityMessage&#x27;, &#x27;engine/helper/box2DHelper&#x27;, &#x27;engine/map/mapLayer&#x27;, &#x27;engine/map/tileSet&#x27;, &#x27;../map/tiledMap&#x27;], function(require, exports, AbstractScreen, VirtualJoystick, KeyboardHelper, EntityManager, EntityMessage, Box2D, MapLayer, TileSet, Map) {
    /**
    * Default implementation of a play level screen. Use this as a base for your own
    * PlayLevelScreen or implement a new one by yourself.
    *
    * @namespace engine.screens
    * @class PlayLevelScreen
    * @extends AbstractScreen
    */
    var PlayLevelScreen = (function (_super) {
        __extends(PlayLevelScreen, _super);
        /**
        * Creates a new &#x60;PlayLevelScreen&#x60;
        *
        * @method __constructor
        * @param renderer {THREE.Renderer} the renderer to use
        */
        function PlayLevelScreen(renderer) {
            _super.call(this, renderer);
        }
        /**
        * Starts to play the given &#x60;map&#x60;
        *
        * @param map {engine.map.Map} the map to play
        *
        */
        PlayLevelScreen.prototype.startMap = function (map) {
            console.log(&quot;start playing map&quot;, map);
        };

        /**
        * Gets called before we render anything.
        * Does nothing - override for your own usage
        *
        * @method preRender
        * @param timeStep {number} time since last render step
        */
        PlayLevelScreen.prototype.preRender = function (timeStep) {
            //overwrite to do own stuff here
        };

        /**
        * Gets called after we rendered everything.
        * Does nothing - override for your own usage
        *
        * @method postRender
        * @param timeStep {number} time since last render step
        */
        PlayLevelScreen.prototype.postRender = function (timeStep) {
            //overwrite to do own stuff here
        };

        /**
        * Gets called before we calculate the physics.
        * Does nothing - override for your own usage
        *
        * @method prePhysics
        * @param timeStep {number} time since last render step
        */
        PlayLevelScreen.prototype.prePhysics = function (timeStep) {
            //overwrite to do own stuff here
        };

        /**
        * Gets called before we do the entity steps.
        * Does nothing - override for your own usage
        *
        * @method preEntitySteps
        * @param timeStep {number} time since last render step
        */
        PlayLevelScreen.prototype.preEntitySteps = function (timeStep) {
            //overwrite to do own stuff here
        };

        /**
        * Gets called by the screenManager when this LevelScreen should render itself.
        * This also calculates the physics and entity movements like so:
        *
        * - *prePhysics
        * - calculatePhysics
        * - *preEntitySteps
        * - calculate entity steps
        * - *preRender
        * - actually call three js render
        * - *postRender
        *
        * the *-methods do nothing and can be overwritten to do own stuff in your level
        *
        * @method render
        * @param timeStep {number} time since last render step
        */
        PlayLevelScreen.prototype.render = function (timeStep) {
            this.prePhysics(timeStep);
            this.calculatePhysics();

            this.preEntitySteps(timeStep);
            this.getEntityManager().doStep(timeStep);

            this.preRender(timeStep);
            this.getRenderer().render(this._scene, this._camera);

            this.postRender(timeStep);
        };

        /**
        * Initializes the physics world. Should be called before using #calculatePhysics()
        * The gravity param should be a b2Vec. If you don&#x27;t set this param there will be
        * no gravity in this world.
        *
        * This also returns the physicsObject. You&#x27;ll find a b2World in the world property
        * of the physicsObject returned.
        *
        * @method initPhsics
        * @param gravity {Box2D.b2Vec2}(optional, defaults 0) the gravity to apply to the world
        * @returns {*} the physics defined
        */
        PlayLevelScreen.prototype.initPhysics = function (gravity) {
            if (typeof gravity === &quot;undefined&quot;) { gravity = new Box2D.b2Vec2(0, 0); }
            this._physicWorld = {
                world: new Box2D.b2World(gravity, true)
            };
            return this.getPhysics();
        };

        /**
        * Does the physic calculations for the given frameRate at the given precision (higher numbers mean higher precision).
        * Should be called once per frame.
        * Warning: You may or may not adjust the frameRate for the physic calculations. This may lead to extremely weird
        * results if the number gets too high or too low. By now 16 seems the best value. Also a iteration value of 10
        * seems to lead to a stable result.
        *
        * @method calculatePhysics
        * @param frameRate {number} (optional, default: 16) the frameRate to use
        * @param velocityIterations {number} (optional, default: 10) the velocityIterations to make per physic step
        * @param positionIterations {number} (optional, default: 10) the positionIterations to make per physic step
        */
        PlayLevelScreen.prototype.calculatePhysics = function (frameRate, velocityIterations, positionIterations) {
            if (typeof frameRate === &quot;undefined&quot;) { frameRate = 16; }
            if (typeof velocityIterations === &quot;undefined&quot;) { velocityIterations = 10; }
            if (typeof positionIterations === &quot;undefined&quot;) { positionIterations = 10; }
            this._physicWorld.world.Step(frameRate, velocityIterations, positionIterations);
            this._physicWorld.world.ClearForces(); //not quite sure if we need this
        };

        /**
        * Sets up a collision listener for the physic world. This will send messages to all
        * entities that collide with each other or collide with walls/other stuff. You need to
        * set the property &quot;entity&quot; in the userData of the b2Body to allow the entities
        * to receive the messages.
        *
        * @private
        * @method _setupPhysicCollisionListener
        *
        */
        PlayLevelScreen.prototype._setupPhysicCollisionListener = function () {
            var colDetector = Box2D.Dynamics.b2ContactListener;

            colDetector.BeginContact = function (contact) {
                var objectA = contact.GetFixtureA().GetBody().GetUserData();
                var objectB = contact.GetFixtureB().GetBody().GetUserData();

                if (objectA.type == &#x27;entity&#x27; &amp;&amp; objectA.entity !== undefined) {
                    //both are entity?
                    if (objectB.type == &#x27;entity&#x27; &amp;&amp; objectB.entity !== undefined) {
                        objectA.entity.sendMessage(new EntityMessage(&#x27;collision:entity&#x27;, { entity: objectB.entity }));
                        objectB.entity.sendMessage(new EntityMessage(&#x27;collision:entity&#x27;, { entity: objectA.entity }));
                    } else {
                        //it&#x27;s some other type of collision... maybe add more specific messages here later on
                        objectA.entity.sendMessage(new EntityMessage(&#x27;collision:other&#x27;, { object: objectB }));
                    }
                } else if (objectB.type == &#x27;entity&#x27; &amp;&amp; objectB.entity !== undefined) {
                    //it&#x27;s some other type of collision... maybe add more specific messages here later on
                    objectB.entity.sendMessage(new EntityMessage(&#x27;collision:other&#x27;, { object: objectA }));
                }
            };
            colDetector.EndContact = function (contact) {
            };

            colDetector.PostSolve = function (contact, impulse) {
            };

            colDetector.PreSolve = function (contact, oldManifold) {
            };

            this.getPhysics().world.SetContactListener(colDetector);
        };

        /**
        * Returns the physics object to do calculations with. The object contains a property &quot;world&quot; which is a b2World
        * object and may be used for the box2d physics. You may add other properties for use in other scripts...
        *
        * @method getPhysics
        * @returns {*} the physics of this level
        */
        PlayLevelScreen.prototype.getPhysics = function () {
            return this._physicWorld;
        };

        /**
        * Sets the camera for this level screen
        *
        * @method setCamera
        * @param camera {THREE.Camera} the camera to set
        */
        PlayLevelScreen.prototype.setCamera = function (camera) {
            this._camera = camera;
        };

        /**
        * Returns the camera for this level screen
        *
        * @method getCamera
        * @returns {THREE.Camera} the camera of this level
        */
        PlayLevelScreen.prototype.getCamera = function () {
            return this._camera;
        };

        /**
        * Sets the ThreeJS scene for this level
        *
        * @method setScene
        * @param scene {THREE.Scene} the scene to set
        */
        PlayLevelScreen.prototype.setScene = function (scene) {
            this._scene = scene;
        };

        /**
        * Returns the ThreeJS scene for this level
        *
        * @method getScene
        * @returns {THREE.Scene}
        */
        PlayLevelScreen.prototype.getScene = function () {
            return this._scene;
        };

        /**
        * Gets called when the level is about to be shown
        *
        * @method show
        * @overrides
        */
        PlayLevelScreen.prototype.show = function () {
            console.log(&quot;show not implemented&quot;);
        };

        /**
        * Returns the EntityManger for this level (lazy loaded if it doesn&#x27;t exist yet)
        *
        * @method getEntityManager
        * @returns {engine.entity.EntityManager} current &#x60;EntityManager&#x60; or lazily created one
        */
        PlayLevelScreen.prototype.getEntityManager = function () {
            if (this._entityManager == null) {
                this._entityManager = new EntityManager(this);
            }
            return this._entityManager;
        };

        /**
        * Returns the joystick used in this level or creates one lazily
        *
        * @method getJoystick
        * @returns {engine.helper.VirtualJoystick} current joystick or lazily created one
        */
        PlayLevelScreen.prototype.getJoystick = function () {
            if (this._joystick == null) {
                this._joystick = new VirtualJoystick();
            }
            return this._joystick;
        };

        /**
        * Returns the current keyboard used in this level or creates one lazily
        *
        * @method getKeyboard
        * @returns {engine.helper.KeyboardHelper} current keyboard or lazily created one
        */
        PlayLevelScreen.prototype.getKeyboard = function () {
            if (this._keyboard == null) {
                this._keyboard = new KeyboardHelper();
            }
            return this._keyboard;
        };
        return PlayLevelScreen;
    })(AbstractScreen);
    ;

    
    return PlayLevelScreen;
});
//# sourceMappingURL=playLevelScreen.js.map

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
